<app-nav-bar></app-nav-bar>

<section class="page">
  <header class="page__header">
    <div>
      <h1>Circuite F1</h1>
      <p class="muted">
        {{ filtered.length }} circuit{{ filtered.length === 1 ? '' : 'e' }} găsit{{ filtered.length === 1 ? '' : 'e' }}.
      </p>
    </div>

    <div class="toolbar">
      <div class="search">
        <input
          type="text"
          placeholder="Caută după nume sau țară…"
          [(ngModel)]="q"
          (input)="applyFilters()"
        />
        <span class="kbd">/</span>
      </div>

      <select [(ngModel)]="sortBy" (change)="applyFilters()" class="sel">
        <option value="name">Sortează: Nume (A–Z)</option>
        <option value="km">Sortează: Km (mic → mare)</option>
      </select>

      <button class="btn ghost" (click)="clearFilters()" [disabled]="!q && !country">
        Reset filtre
      </button>
    </div>
  </header>

  <!-- filtre rapide pe țări (se umplu din date) -->
  <div class="chips" *ngIf="countries.length">
    <button
      class="chip"
      [class.chip--active]="country === ''"
      (click)="setCountry('')"
    >Toate</button>

    <button
      class="chip"
      *ngFor="let c of countries"
      [class.chip--active]="country === c"
      (click)="setCountry(c)"
      [title]="c"
    >
      {{ c }}
    </button>
  </div>

  <!-- empty state -->
  <div class="empty" *ngIf="!loading && filtered.length === 0">
    <div class="empty__card">
      <h3>Nu am găsit nimic</h3>
      <p class="muted">Încearcă alt termen de căutare sau scoate filtrele.</p>
      <button class="btn" (click)="clearFilters()">Resetează filtrele</button>
    </div>
  </div>

  <!-- grid cu carduri -->
  <div class="grid" *ngIf="!loading && filtered.length">
    <article class="card" *ngFor="let c of filtered" (click)="circuiteDetails(c.id, c.name)">
      <div class="card__head">
        <h3 class="card__title">{{ c.name }}</h3>
        <span class="badge">{{ c.country }}</span>
      </div>

      <div class="card__meta">
        <span class="meta">
          <svg viewBox="0 0 24 24" class="i"><path d="M7 19h10M12 4v12"></path></svg>
          {{ c.km | number:'1.3-3' }} km
        </span>
      </div>

      <div class="card__actions">
        <button class="btn small" (click)="circuiteDetails(c.id, c.name); $event.stopPropagation()">Detalii</button>
      </div>
    </article>
  </div>

  <!-- skeleton (opțional) -->
  <div class="grid" *ngIf="loading">
    <div class="skeleton" *ngFor="let _ of [0,1,2,3,4,5,6,7]"></div>
  </div>
</section>

<app-footer></app-footer>
