<app-nav-bar></app-nav-bar>

<section class="page">
  <header class="page__header">
    <h1>Profilul meu</h1>
  </header>

  <div class="empty" *ngIf="loading">
    <p>Se încarcă profilul...</p>
  </div>

  <div class="empty" *ngIf="!loading && error">
    <div class="empty__card">
      <h3>Eroare</h3>
      <p class="muted">{{ error }}</p>
      <button class="btn" (click)="goToLogin()">Mergi la Login</button>
    </div>
  </div>

  <div class="profile-container" *ngIf="!loading && profile">
    <!-- Imagine profil -->
    <div class="profile-image-section">
      <img [src]="getProfileImageUrl()" alt="Profile Image" class="profile-image" />
      
      <!-- Upload imagine -->
      <div class="upload-section">
        <input 
          type="file" 
          accept="image/png,image/jpeg,image/jpg,image/gif,image/webp"
          (change)="onFileSelected($event)" 
          #fileInput
          style="display: none;"
        />
        <button class="btn small" (click)="fileInput.click()" [disabled]="uploading">
          {{ selectedFile ? 'Schimbă imaginea' : 'Alege imagine' }}
        </button>
        
        <button 
          class="btn small" 
          *ngIf="selectedFile" 
          (click)="uploadImage()"
          [disabled]="uploading"
        >
          {{ uploading ? 'Se încarcă...' : 'Salvează' }}
        </button>
        
        <p class="muted" *ngIf="selectedFile">{{ selectedFile.name }}</p>
      </div>
    </div>

    <!-- Informații profil -->
    <div class="profile-info">
      <div class="info-row">
        <span class="label">Nume:</span>
        <span class="value">{{ profile.firstName }} {{ profile.lastName }}</span>
      </div>

      <div class="info-row">
        <span class="label">Email:</span>
        <span class="value">{{ profile.email }}</span>
      </div>

      <div class="info-row">
        <span class="label">Rol:</span>
        <span class="value">{{ profile.role }}</span>
      </div>

      <div class="info-row" *ngIf="profile.lapCount !== undefined">
        <span class="label">Tururi înregistrate:</span>
        <span class="value">{{ profile.lapCount }}</span>
      </div>

      <div class="info-row">
        <span class="label">Cont creat:</span>
        <span class="value">{{ profile.createdAt | date: 'mediumDate' }}</span>
      </div>
    </div>

    <div class="profile-actions">
      <button class="btn btn-logout" (click)="logout()">Logout</button>
    </div>
  </div>
</section>

<app-footer></app-footer>