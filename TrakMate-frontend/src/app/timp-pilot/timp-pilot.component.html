<app-nav-bar></app-nav-bar>

<section class="page">
  <header class="page__header">
    <h1>Timpi Ã®nregistraÈ›i de {{ pilotName }}</h1>
    <p class="muted">
      Total: {{ times.length }} tur{{ times.length === 1 ? '' : 'uri' }} Ã®nregistrate pe diverse circuite.
    </p>
  </header>

  <div class="toolbar">
    <button class="btn ghost" (click)="router.navigate(['/pilot'])">â† Ãnapoi la PiloÈ›i</button>

    <select [(ngModel)]="sortBy" (change)="applySort()" class="sel">
      <option value="time">SorteazÄƒ: Cel mai rapid timp</option>
      <option value="date">SorteazÄƒ: Data (cel mai recent)</option>
    </select>

    <button class="btn" *ngIf="canEditPage()" (click)="showForm = !showForm">
      {{ showForm ? 'AnuleazÄƒ' : 'AdaugÄƒ timp' }}
    </button>
  </div>

  <form class="add-time" *ngIf="showForm && canEditPage()" (ngSubmit)="submitNewTime()">
    <div class="row">
      <input type="text" placeholder="Circuit (ex. Silverstone)" [(ngModel)]="form.circuitName" name="circuitName" required />
      <input type="text" placeholder="ÈšarÄƒ (ex. Marea Britanie)" [(ngModel)]="form.country" name="country" required />
    </div>
    <div class="row">
      <input type="text" placeholder="Sector 1 (MM:SS.mmm sau ms)" [(ngModel)]="form.sector1" name="sector1" required />
      <input type="text" placeholder="Sector 2 (MM:SS.mmm sau ms)" [(ngModel)]="form.sector2" name="sector2" required />
      <input type="text" placeholder="Sector 3 (MM:SS.mmm sau ms)" [(ngModel)]="form.sector3" name="sector3" required />
      <button class="btn" type="submit">SalveazÄƒ</button>
    </div>
    <p class="muted">Exemple: <code>00:25.340</code> sau <code>25340</code> (ms) pentru fiecare sector</p>
  </form>

  <div class="empty" *ngIf="loading">
    <p>Se Ã®ncarcÄƒ timpii pilotului {{ pilotName }}...</p>
    <div class="skeleton-table"></div>
  </div>

  <div class="empty" *ngIf="!loading && times.length === 0">
    <div class="empty__card">
      <h3>Niciun timp Ã®nregistrat</h3>
      <p class="muted">Pilotul {{ pilotName }} nu are Ã®ncÄƒ timpi Ã®n baza de date.</p>
    </div>
  </div>

  <div class="table-container" *ngIf="!loading && times.length">
    <table class="data-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Circuit</th>
          <th>ÈšarÄƒ</th>
          <th>Sector 1</th>
          <th>Sector 2</th>
          <th>Sector 3</th>
          <th>Timp Total</th>
          <th>Data</th>
          <th *ngIf="canEditPage()">AcÈ›iuni</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let time of times; let i = index">
          <td><span class="rank" *ngIf="i === 0">ğŸ†</span><span *ngIf="i > 0">{{ i + 1 }}</span></td>
          <td>{{ time.circuit.name }}</td>
          <td>{{ time.circuit.country }}</td>
          <td><span class="sector-time">{{ formatSectorTime(time.sector1Ms) }}</span></td>
          <td><span class="sector-time">{{ formatSectorTime(time.sector2Ms) }}</span></td>
          <td><span class="sector-time">{{ formatSectorTime(time.sector3Ms) }}</span></td>
          <td><span class="lap-time" [class.best-lap]="i === 0">{{ formatLapTime(time.lapTimeMs) }}</span></td>
          <td>{{ time.createdAt | date: 'mediumDate' }}</td>
          <td *ngIf="canEditPage()">
            <button 
              class="btn btn-delete" 
              *ngIf="canDeleteTime(time)"
              (click)="deleteTime(time.id)"
            >
              ğŸ—‘ï¸ È˜terge
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</section>

<app-footer></app-footer>